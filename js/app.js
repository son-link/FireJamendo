var baseurl="https://api.jamendo.com/v3.0/";var client_id="795e43fd";var client_secret="e82c69ed561875cbad2868b209551b4c";var data;var playlist={};var player=document.getElementById("player");var currentTrack=0;var currentRadio=0;var artist_albums={};var artist_tracks={};var user_tracks={};var top_tracks={};var album_tracks={};var access_token;var radio_interval;var artist_id=0;var album_id=0;var qs=function(selector){return document.querySelector(selector)};var feed={};var jamendoLangs=["en","es","it","de","fr","pl"];var config;var _=navigator.mozL10n.get;navigator.mozL10n.once(start);function start(){config=JSON.stringify({top_orderby:"popularity_total",profile_limit:10,top_limit:10,down_format:"ogg1",share_track:_("share-track"),share_artist:_("share-artist"),share_album:_("share-album"),notification_msg:_("notification-msg"),show_notifications:true,album_reviews_lang:"any",album_reviews_order:"addeddate",reviews_order_descent:false,hasscore:false,album_reviews_limit:10});lang=navigator.mozL10n.language.code;checkConfig();getNews()}var localCache={data:{},remove:function(url){delete localCache.data[url]},exist:function(url){return localCache.data.hasOwnProperty(url)&&localCache.data[url]!==null},get:function(url){console.log("Getting in cache for url "+url);return localCache.data[url]},set:function(url,cachedData,callback){localCache.remove(url);localCache.data[url]=cachedData;if($.isFunction(callback))callback(cachedData)}};function convertTime(secs){var minutes=parseInt(secs/60)%60;var seconds=parseInt(secs%60);minutes<10?minutes="0"+minutes:"";seconds<10?seconds="0"+seconds:"";return"{0}:{1}".format(minutes,seconds)}if(!String.prototype.format){String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!="undefined"?args[number]:match})}}function getConf(key){return JSON.parse(localStorage.config)[key]}function getData(params,cb){qs("#loading").style.display="block";if(params.search(/\?/)==-1){params+="?client_id="+client_id}else{params+="&client_id="+client_id}var url=baseurl+params;$.ajax({url:url,type:"GET",dataType:"json",cache:true,error:function(xhr,status,error){qs("#loading").style.display="none";if(status!="abort"){onError(_("data_error"))}},success:function(json){qs("#loading").style.display="none";if(cb){localCache.set(url,json,cb)}},beforeSend:function(){if(localCache.exist(url)){qs("#loading").style.display="none";cb(localCache.get(url));return false}return true}})}function changeDIV(div){divs=["radios","news","artist-info","now-listen","jamendo-top","search","profile","config","album-info","download_list"];for(i=0;i<divs.length-1;i++){if(div==divs[i]){qs("#"+div).style.display="block"}else{qs("#"+divs[i]).style.display="none"}}}function changeTab(tab,tabs){for(i=0;i<tabs.length;i++){if(tab==tabs[i]){qs("#"+tab).style.display="block";$('a[data-tab="'+tab+'"]').parent().addClass("active")}else{qs("#"+tabs[i]).style.display="none";if($('a[data-tab="'+tabs[i]+'"]').parent().hasClass("active")){$('a[data-tab="'+tabs[i]+'"]').parent().toggleClass("active")}}}}function onError(msg){console.error(msg);qs("#error").style.display="block";setTimeout(function(){qs("#error").style.display="none"},5e3);$("#error").text(msg)}function checkConfig(){if(localStorage.config){conf=localStorage.config;$.each(config,function(key,value){if(!conf[key]){conf[key]=config[key]}});localStorage.setItem("config",conf)}else if(localStorage.top_orderby){$.each(config,function(key,value){if(localStorage[key]){config[key]=localStorage[key];localStorage[key]=""}});localStorage.setItem("config",config)}else{localStorage.setItem("config",config)}}function notifyMe(body){if(!("Notification"in window)){alert("This browser does not support desktop notification")}else if(Notification.permission==="granted"){var notification=new Notification("Firejamendo",{body:body,icon:playlist[currentTrack].image,tag:"firejamendo"});notification.onclick=function(){$("#section-title").text(_("now-listen"));changeDIV("now-listen")}}else if(Notification.permission!=="denied"){Notification.requestPermission(function(permission){if(permission==="granted"){var notification=new Notification("FireJamendo",{body:body,icon:playlist[currentTrack].image,tag:"firejamendo"});notification.onclick=function(){$("#section-title").text(_("now-listen"));changeDIV("now-listen")}}})}}function startPlay(){if(player){player.pause()}if(playlist[currentTrack].audio.search("https://streaming.jamendo.com")!=0){clearInterval(radio_interval)}player.src=playlist[currentTrack].audio;player.setAttribute("mozaudiochannel","content");player.load();player.play();$("#track-name").text(playlist[currentTrack].track_name);$("#artist").text(playlist[currentTrack].artist_name);notifyMsg=playlist[currentTrack].artist_name+" - "+playlist[currentTrack].track_name;document.title="FireJamendo: "+notifyMsg;if(getConf("show_notifications")){notifyMe(notifyMsg)}$("#album-art").attr("src",playlist[currentTrack].image);if(playlist[currentTrack].album_name){$("#album").text(playlist[currentTrack].album_name)}$(".download").attr("href","http://storage-new.newjamendo.com/download/track/{0}/{1}/".format(playlist[currentTrack].track_id,getConf("down_format")));$("#play i").removeClass("icon-play");$("#play i").addClass("icon-pause");var seekbar=document.getElementById("seekbar");seekbar.addEventListener("change",function(){player.currentTime=seekbar.value});seekbar.max=player.duration;player.addEventListener("timeupdate",function(){var curtime=parseInt(player.currentTime,10);seekbar.value=curtime;seekbar.max=player.duration;$("#current-time").text(convertTime(curtime));$("#total-time").text(convertTime(player.duration))});player.addEventListener("ended",function _func(){if(currentTrack==Object.keys(playlist).length-1){player.pause();seekbar.value=0;currentTrack=0;$("#current-time").text("00:00");$("#play i").removeClass("icon-pause");$("#play i").addClass("icon-play")}else{player.removeEventListener("ended",_func);nextTrack()}});player.addEventListener("error",function(e){console.error(e);onError(_("stream_error"));clearInterval(radio_interval);player.pause();player.src=""});player.addEventListener("mozinterruptbegin",function onInterrupted(e){console.error(e)})}function getAlbum(id){changeDIV("album-info");$("#section-title").text(_("album-info"));changeTab("album-tracks",["album-tracks","album-reviews"]);getData("albums/tracks?audioformat=ogg&id="+id,function(responseText){data=responseText.results[0];album_tracks={};album_id=id;$("#album-tracks ul").empty();cover="";if(data.image){cover=data.image}else{cover="img/no-image.png"}$("#album_cover").attr("src",cover);$("#album_name").text(data.name);$("#album_artist").text(data.artist_name);$("#down_album").attr("href","https://storage-new.newjamendo.com/download/a{0}/{1}/".format(id,getConf("down_format")));for(i=0;i<data.tracks.length;i++){track_name=data.tracks[i].name;audio=data.tracks[i].audio;album_tracks[i]={artist_name:data.artist_name,album_name:data.name,track_name:track_name,image:cover,audio:audio,track_id:data.tracks[i].id};$("#album-tracks ul").append('<li><p><a href="#" data-album-track="{0}">{1}</a></p></li>'.format(i,track_name))}});var params="album_id={0}&limit{1}".format(id,getConf("album_reviews_limit"));orderby=getConf("album_reviews_order");if(getConf("reviews_order_descent")){orderby+="_desc"}params+="&order="+orderby;if(getConf("album_reviews_lang")!="any"){params+="&lang="+getConf("album_reviews_lang")}if(getConf("hasscore")){params+="&hasscore=true"}getData("reviews/albums?"+params,function(responseText){data=responseText.results;$.each(data,function(key,value){if(value.score>=1){value.score=parseInt(value.score)*10}else{value.score=0}$("#album-reviews ul").append(tmpl("reviews",value))})})}function getPlaylist(id){getData("playlists/tracks?audioformat=ogg&id="+id,function(responseText){playlist={};currentTrack=0;data=responseText.results[0];for(i=0;i<data.tracks.length;i++){track_name=data.tracks[i].name;audio=data.tracks[i].audio;playlist[i]={artist_name:data.tracks[i].artist_name,track_name:track_name,image:data.tracks[i].album_image,audio:audio,track_id:data.tracks[i].id,album_name:data.tracks[i].name}}changeDIV("now-listen");qs("#controls").style.display="block";qs("#radio-control").style.display="none";startPlay()})}function getArtistTracks(id,cb){getData("artists/tracks?audioformat=ogg&imagesize=100&id="+id,function(responseText){data=responseText.results[0];topTracks={};i=0;$.each(data.tracks,function(key,value){track_name=value.name;audio=value.audio;topTracks[i]={track_id:value.id,artist_name:data.name,track_name:track_name,image:value.album_image,audio:audio,album_name:value.album_name};i++});if(typeof cb==="function"){cb(topTracks)}})}function getRadioStream(id){changeDIV("now-listen");$("#section-title").text(_("now-listen"));if(currentRadio!=id||player.src!=""){clearInterval(radio_interval);currentRadio=id;getData("radios/stream?id="+id,function(responseText){playlist={};$("#play-radio i").removeClass("icon-play");$("#play-radio i").addClass("icon-pause");data=responseText.results[0];playlist[0]={artist_name:data.playingnow.artist_name,track_name:data.playingnow.track_name,image:data.playingnow.track_image,audio:data.stream,album_name:data.playingnow.album_name,track_id:data.playingnow.track_id};qs("#controls").style.display="none";qs("#radio-control").style.display="block";radio_interval=setInterval(function(){getRadioStream(id)},parseInt(data.callmeback));currentTrack=0;startPlay()})}else{getData("radios/stream?id="+id,function(responseText){data=responseText.results[0];$("#track-name").text(data.playingnow.track_name);$("#artist").text(data.playingnow.artist_name);$("#album-art").attr("src",data.playingnow.track_image);$("#album").text(data.playingnow.album_name);playlist[0].track_id=data.playingnow.track_id;radio_interval=setInterval(function(){getRadioStream(id)},parseInt(data.callmeback))})}}function getTrack(id){getData("artists/tracks?audioformat=ogg&imagesize=100&track_id="+id,function(responseText){data=responseText.results[0].tracks[0];playlist={};currentTrack=0;playlist[0]={artist_name:responseText.results[0].name,track_name:data.track_name,image:data.album_image,audio:data.audio,album_name:data.album_name,download:data.audiodownload,track_id:data.id};qs("#controls").style.display="block";qs("#radio-control").style.display="none";changeDIV("now-listen");$("#section-title").text(_("now-listen"));startPlay()})}function getTop(top){params=top+"/?order={0}&limit={1}&imagesize=100".format(getConf("top_orderby"),parseInt(getConf("top_limit")));getData(params,function(responseText){data=responseText.results;$("#top-list").empty();for(i=0;i<data.length;i++){info={};cover="";if(data[i].album_image){cover=data[i].album_image}else if(data[i].image){cover=data[i].image}else{cover="img/no-image.png"}if(top=="albums"){info={id:data[i].id,cover:cover,name:data[i].name,artist:data[i].artist_name,type:"album"}}else if(top=="artists"){info={id:data[i].id,cover:cover,name:null,artist:data[i].name,type:"artist"}}else{top_tracks[i]={artist_name:data[i].artist_name,track_name:data[i].name,image:cover,audio:data[i].audio,album_name:data[i].album_name,download:data[i].audiodownload,track_id:data[i].id};info={id:i,cover:cover,name:data[i].name,artist:data[i].artist_name,type:"track"}}$("#top-list").append(tmpl("top_list_template",info))}$("#top-tabs .tab a").each(function(index){if($(this).attr("id")=="top-"+top){$(this).parent().addClass("active")}else{$(this).parent().removeClass("active")}})})}function nextTrack(){if(currentTrack>=0&&currentTrack<Object.keys(playlist).length-1){currentTrack+=1;player.pause();startPlay()}}function getNews(){if(Object.keys(feed).length>0){$("#news").empty();$.each(feed,function(key,value){$("#news").append(tmpl("feed",value))})}else{getData("feeds/",function(responseText){if(navigator.mozL10n.language.code=="es"){lang="es"}else if(navigator.mozL10n.language.code=="it"){lang="it"}else if(navigator.mozL10n.language.code=="ge"){lang="ge"}else{lang="en"}data=responseText.results;for(i=0;i<data.length;i++){text="";if(data[i].text[lang]){data[i].text=data[i].text[lang]}else{data[i].text=data[i].text.en}if(data[i].title[lang]){data[i].title=data[i].title[lang]}else{data[i].title=data[i].title.en}if(data[i].subtitle.en&&data[i].subtitle[lang]){data[i].subtitle=data[i].subtitle[lang]}else{data[i].subtitle=_(data[i].type)}if(data[i].type!="news"){data[i].link="#"}feed[i]=data[i];$("#news").append(tmpl("feed",data[i]))}})}}function getArtistData(id){artist_id=id;changeDIV("artist-info");changeTab("artist-albums",["artist-tracks","artist-albums"]);getData("artists/albums?limit=all&id="+id,function(responseText){data=responseText.results[0];$("#artist-albums").empty();$("#artist_name").text(data.name);$("#artist_cover").attr("src",responseText.results[0].image);for(i=0;i<data.albums.length;i++){cover="";if(data.albums[i].image){cover=data.albums[i].image}else{cover="img/no-image.png"}artist_albums[i]={album_name:data.albums[i].name,image:cover,id:data.albums[i].id};info={id:data.albums[i].id,cover:cover,name:null,artist:data.albums[i].name,type:null};$("#artist-albums").append(tmpl("top_list_template",info))}$("#artist_cover").attr("src",responseText.results[0].image)});getArtistTracks(id,function(data){i=0;$("#artist-tracks ul").empty();$.each(data,function(key,value){cover="";if(value.image){cover=value.image}else{cover="img/no-image.png"}artist_tracks[i]={artist_name:value.artist_name,track_name:value.track_name,image:cover,audio:value.audio,album_name:value.album_name,track_id:value.track_id};info={id:i,name:value.track_name};$("#artist-tracks ul").append(tmpl("playlist",info));i++})})}$("#search-btn").click(function(e){e.preventDefault();search=$("#search-input").val();searchby=$("#search-by").val();orderby=$("#order-by").val();limit=$("#limit option:selected").text();params="{0}/?namesearch={1}&order={2}&limit={3}".format(searchby,search,orderby,limit);if(search){getData(params,function(responseText){$("#search-results").empty();data=responseText.results;$.each(data,function(key,value){image="";if(value.image==""||value.album_image==""){image="img/no-image.png"}else if(value.image){image=value.image}else{image=value.album_image}info={id:value.id,cover:image,name:null,artist:value.name,type:searchby};$("#search-results").append(tmpl("top_list_template",info))})})}});function getToken(url,type){if(type=="new"){params={client_id:client_id,client_secret:client_secret,code:localStorage.code,grant_type:"authorization_code",redirect_uri:url}}else if(type=="refresh"){params={client_id:client_id,client_secret:client_secret,grant_type:"refresh_token",refresh_token:localStorage.refresh_token}}$.ajax({url:"https://api.jamendo.com/v3.0/oauth/grant",data:params,type:"POST",dataType:"json",error:function(xhr,status,error){console.error(status)},success:function(jsonp){$("#btn-login").html('<i class="icon-logout"></i> '+_("logout")+"");localStorage.access_token=jsonp.access_token;localStorage.refresh_token=jsonp.refresh_token;if(type=="refresh"){getUserData()}}})}function JamendoLogin(){url="";if(window.location.protocol=="app:"){url="http://localhost"}else{url=window.location.href.replace(/[^\/]*$/,"")+"redirect.html"}OauthUrl="https://api.jamendo.com/v3.0/oauth/authorize?client_id="+client_id+"&redirect_uri="+url;if(!localStorage.access_token){var authWindow=window.open(OauthUrl);window.addEventListener("message",function(evt){authWindow.close();localStorage.code=evt.data.code;getToken(url,"new")})}else{getToken(url,"refresh")}}function JamendoLogout(){localStorage.username="";localStorage.user_image="";localStorage.code="";localStorage.access_token="";localStorage.refresh_token="";$("#btn-login").html('<i class="icon-login"></i> '+_("login")+"")}function getUserData(){changeDIV("profile");if($("#user-albums").is(":empty")){changeTab("user-albums",["user-tracks","user-albums","user-artists","user-playlists"])}$("#section-title").text(_("profile"));$("#user-albums").empty();$("#user-tracks").empty();$("#user-artists").empty();getData("users/albums?access_token={0}&limit={1}".format(localStorage.access_token,getConf("profile_limit")),function(responseText){if(responseText.headers.error_message=="Jamendo Api Access Token Error: The access token provided has expired"){JamendoLogin();return false}data=responseText.results[0];$("#user_img").attr("src",data.image);$("#username").text(data.dispname);for(i=0;i<data.albums.length;i++){cover="";if(data.albums[i].image){cover=data.albums[i].image}else{cover="img/no-image.png"}info={id:data.albums[i].id,cover:cover,name:data.albums[i].name,artist:data.albums[i].artist_name,type:null};$("#user-albums").append(tmpl("top_list_template",info))}});getData("users/artists?access_token="+localStorage.access_token,function(responseText){data=responseText.results[0];for(i=0;i<data.artists.length;i++){cover="";if(data.artists[i].image){cover=data.artists[i].image}else{cover="img/no-image.png"}info={id:data.artists[i].id,cover:cover,name:null,artist:data.artists[i].name,type:null};$("#user-artists").append(tmpl("top_list_template",info))}});getData("users/tracks?access_token="+localStorage.access_token,function(responseText){data=responseText.results[0];for(i=0;i<data.tracks.length;i++){cover="";if(data.tracks[i].album_image){cover=data.tracks[i].album_image}else{cover="img/no-image.png"}user_tracks[i]={artist_name:data.tracks[i].artist_name,track_name:data.tracks[i].name,image:cover,audio:data.tracks[i].audio,album_name:data.tracks[i].album_name,track_id:data.tracks[i].id};info={id:data.tracks[i].id,cover:cover,name:data.tracks[i].name,artist:data.tracks[i].artist_name,type:null};$("#user-tracks").append(tmpl("top_list_template",info))}});getData("playlists/?access_token="+localStorage.access_token,function(responseText){data=responseText.results;$("#user-playlists ul").empty();$.each(data,function(key,value){$("#user-playlists ul").append(tmpl("playlist",value))})})}function share(web,type){msg="";url="";if(web!="fav"){if(type=="now-listen"&&playlist[currentTrack]){url="http://jamen.do/t/"+playlist[currentTrack].track_id;msg=getConf("share_track").format(playlist[currentTrack].track_name,playlist[currentTrack].artist_name)}else if(type=="artist"&&artist_id!=0){url="http://jamen.do/a/"+artist_id;msg=getConf("share_artist").format($("#artist_name").text())}else if(type=="album"&&album_id!=0){url="http://jamen.do/l/a"+album_id;msg=getConf("share_album").format($("#album_name").text(),$("#album_artist").text())}else{return false}if(web=="twitter"){ShareUrl="http://twitter.com/intent/tweet?text="+encodeURIComponent(msg)+"&url="+url}else if(web=="facebook"){ShareUrl="http://www.facebook.com/sharer/sharer.php?u="+url}else if(web=="g+"){ShareUrl="https://plus.google.com/share?url="+url}window.open(ShareUrl)}else{if(type=="now-listen"){like()}}}document.addEventListener("DOMContentLoaded",function(){changeDIV("news");$("#news").delegate("a","click",function(){id=$(this).attr("id");type=$(this).attr("data-type");if(type=="album"){getAlbum(id)}else if(type=="playlist"){getPlaylist(id)}else if(type=="artist"){getArtistData(id)}else if(type=="news"){window.open($(this).attr("href"))}else{getArtistTracks(id,function(data){playlist=data});changeDIV("now-listen")}});$("body").delegate('a[href="#"]',"click",function(e){e.preventDefault()});$("#radios").delegate("a","click",function(){id=$(this).attr("id");getRadioStream(id)});$("#top-list").delegate("a","click",function(){type=$(this).attr("data-type");if(type=="album"){getAlbum($(this).attr("id"))}else if(type=="artist"){getArtistData($(this).attr("id"));$("#section-title").text(_("artist"));changeDIV("artist-info")}else{playlist=top_tracks;currentTrack=parseInt($(this).attr("id"));startPlay();$("#section-title").text(_("now-listen"));qs("#controls").style.display="block";qs("#radio-control").style.display="none";changeDIV("now-listen")}});$("#search-results").delegate("a","click",function(){id=$(this).attr("id");type=$(this).attr("data-type");if(type=="albums"){getAlbum(id)}else if(type=="tracks"){getTrack(id)}else{getArtistData(id);$("#section-title").text(_("artist"));changeDIV("artist-info")}});$("#artist-tracks, #user-tracks").delegate("a","click",function(){if($(this).attr("data-type")=="artist-track"){playlist=artist_tracks}else{playlist=user_tracks}currentTrack=parseInt($(this).attr("track-id"));$("#section-title").text(_("now-listen"));qs("#controls").style.display="block";qs("#radio-control").style.display="none";changeDIV("now-listen");startPlay()});$("#artist-albums, #user-albums").delegate("a","click",function(){$("#section-title").text(_("now-listen"));getAlbum(parseInt($(this).attr("id")))});$("#user-playlists ul").delegate("a","click",function(){id=$(this).attr("playlist-id");getPlaylist(id);$("#section-title").text(_("now-listen"));changeDIV("now-listen")});$("#album-tracks ul").delegate("a","click",function(){currentTrack=parseInt($(this).attr("data-album-track"));playlist=album_tracks;$("#section-title").text(_("now-listen"));changeDIV("now-listen");qs("#controls").style.display="block";qs("#radio-control").style.display="none";startPlay()})});$("#menu ul li a").click(function(){$("#menuLink").removeClass("active");$("#menu").removeClass("active");$("#layout").removeClass("active")});$("#main").click(function(){if($("#menuLink").hasClass("active")){$("#menuLink").removeClass("active");$("#menu").removeClass("active");$("#layout").removeClass("active")}});$("#btn-now-listen").click(function(){changeDIV("now-listen");$("#section-title").text(_("now-listen"))});$("#btn-radios").click(function(){changeDIV("radios");$("#section-title").text(_("radios"));if($("#radios").is(":empty")){getData("radios",function(responseText){data=responseText.results;for(i=0;i<data.length;i++){$("#radios").append('<div class="pure-u-1-2 pure-u-md-1-2 pure-u-lg-1-5"><a href="#" id="{0}"><img src="{1}" class="pure-img"><p>{2}</p></a></div>'.format(data[i].id,data[i].image,data[i].dispname))}})}});$("#btn-top").click(function(){$("#section-title").text(_("top"));changeDIV("jamendo-top")});$("#btn-artist-info").click(function(){$("#section-title").text(_("artist"));changeDIV("artist-info")});$("#btn-news").click(function(){$("#section-title").text(_("news"));changeDIV("news");getNews()});$("#btn-search").click(function(){$("#section-title").text(_("search"));changeDIV("search")});$("#play, #play-radio").click(function(){if(player.paused){$("i",this).removeClass("icon-play");$("i",this).addClass("icon-pause");if($(this).attr("id")=="play-radio"){player.src="";getRadioStream(currentRadio)}else{player.play()}}else{if($(this).attr("id")=="play-radio"){clearInterval(radio_interval)}player.pause();$("i",this).removeClass("icon-pause");$("i",this).addClass("icon-play")}});$("#next").click(function(){if(player){nextTrack()}});$("#stop").click(function(){if(player){$("#play i").removeClass("icon-pause");$("#play i").addClass("icon-play");player.pause();seekbar.value=0;player.currentTime=0}});$("#back").click(function(){if(currentTrack>0){currentTrack-=1;player.pause();startPlay()}});$("#top-tabs a").click(function(){tab=$(this).attr("id").split("-")[1];getTop(tab)});$("#btn-profile").click(function(){if(!localStorage.access_token){onError(_("no-logged"))}else{getUserData()}});$("#btn-login").click(function(){if(localStorage.access_token){JamendoLogout()}else{JamendoLogin()}});$("#btn-album-info").click(function(){$("#section-title").text(_("album-info"));changeDIV("album-info")});$("#artist-tabs .tab a").click(function(){tab=$(this).attr("data-tab");changeTab(tab,["artist-tracks","artist-albums"])});$("#user-tabs .tab a").click(function(){tab=$(this).attr("data-tab");changeTab(tab,["user-tracks","user-albums","user-artists","user-playlists"])});$("#album-tabs .tab a").click(function(){tab=$(this).attr("data-tab");changeTab(tab,["album-tracks","album-reviews"])});$(".share_buttons a").click(function(){type=$(this).closest("div").attr("data-type");share($(this).attr("id"),type)});$("#btn-config").click(function(){conf=JSON.parse(localStorage.config);if(localStorage.access_token){$("#btn-login").html('<i class="icon-logout"></i> '+_("logout"))}else{$("#btn-login").html('<i class="icon-login"></i> '+_("login"))}$("#section-title").text(_("config"));$("#config-form").find("input, select").each(function(){this.value=conf[this.id];if(this.id=="show_notifications"||this.id=="reviews_order_descent"||this.id=="hasscore"){this.checked=conf[this.id]}});changeDIV("config")});$("#saveconf").click(function(e){e.preventDefault();conf=JSON.parse(localStorage.config);$("#config-form").find("input, select").each(function(){if(this.id!="saveconf"){if(this.id=="profile_limit"||this.id=="top_limit"){if(this.value<10||this.value>100){$(this).addClass("form_error");$(this).focus();onError(_("limit_error"));return false}else{conf[this.id]=this.value;$(this).removeClass("form_error")}}else if(this.id=="show_notifications"||this.id=="hasscore"||this.id=="reviews_order_descent"){conf[this.id]=this.checked}else{conf[this.id]=this.value}}localStorage.setItem("config",JSON.stringify(conf))})});$("#clear-data").click(function(e){e.preventDefault();clear=confirm(_("clear-data-msg"));if(clear){localStorage.clear();localStorage.setItem("config",config);conf=JSON.parse(config);$("#config-form").find("input, select").each(function(){this.value=conf[this.id];if(this.id=="show_notifications"||this.id=="reviews_order_descent"||this.id=="hasscore"){this.checked=conf[this.id]}})}});$("#user-artists").delegate("a","click",function(){getArtistData($(this).attr("id"));$("#section-title").text(_("artist"));changeDIV("artist-info");changeTab("artist-albums",["artist-tracks","artist-albums"])});window.addEventListener("unload",function(){if(player){player.pause();player.src="";player=null}});(function(){var cache={};this.tmpl=function tmpl(str,data){var fn=!/\W/.test(str)?cache[str]=cache[str]||tmpl(document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return data?fn(data):fn}})();(function(window,undefined){"use strict";function L10nError(message,id,loc){this.name="L10nError";this.message=message;this.id=id;this.loc=loc}L10nError.prototype=Object.create(Error.prototype);L10nError.prototype.constructor=L10nError;var io={_load:function(type,url,callback,sync){var xhr=new XMLHttpRequest;var needParse;if(xhr.overrideMimeType){xhr.overrideMimeType(type)}xhr.open("GET",url,!sync);if(type==="application/json"){if(sync){needParse=true}else{xhr.responseType="json"}}xhr.addEventListener("load",function io_onload(e){if(e.target.status===200||e.target.status===0){var res=e.target.response||e.target.responseText;callback(null,needParse?JSON.parse(res):res)}else{callback(new L10nError("Not found: "+url))}});xhr.addEventListener("error",callback);xhr.addEventListener("timeout",callback);try{xhr.send(null)}catch(e){if(e.name==="NS_ERROR_FILE_NOT_FOUND"){callback(new L10nError("Not found: "+url))}else{throw e}}},load:function(url,callback,sync){return io._load("text/plain",url,callback,sync)},loadJSON:function(url,callback,sync){return io._load("application/json",url,callback,sync)}};function EventEmitter(){}EventEmitter.prototype.emit=function ee_emit(){if(!this._listeners){return}var args=Array.prototype.slice.call(arguments);var type=args.shift();if(!this._listeners[type]){return}var typeListeners=this._listeners[type].slice();for(var i=0;i<typeListeners.length;i++){typeListeners[i].apply(this,args)}};EventEmitter.prototype.addEventListener=function ee_add(type,listener){if(!this._listeners){this._listeners={}}if(!(type in this._listeners)){this._listeners[type]=[]}this._listeners[type].push(listener)};EventEmitter.prototype.removeEventListener=function ee_rm(type,listener){if(!this._listeners){return}var typeListeners=this._listeners[type];var pos=typeListeners.indexOf(listener);if(pos===-1){return}typeListeners.splice(pos,1)};function getPluralRule(lang){var locales2rules={af:3,ak:4,am:4,ar:1,asa:3,az:0,be:11,bem:3,bez:3,bg:3,bh:4,bm:0,bn:3,bo:0,br:20,brx:3,bs:11,ca:3,cgg:3,chr:3,cs:12,cy:17,da:3,de:3,dv:3,dz:0,ee:3,el:3,en:3,eo:3,es:3,et:3,eu:3,fa:0,ff:5,fi:3,fil:4,fo:3,fr:5,fur:3,fy:3,ga:8,gd:24,gl:3,gsw:3,gu:3,guw:4,gv:23,ha:3,haw:3,he:2,hi:4,hr:11,hu:0,id:0,ig:0,ii:0,is:3,it:3,iu:7,ja:0,jmc:3,jv:0,ka:0,kab:5,kaj:3,kcg:3,kde:0,kea:0,kk:3,kl:3,km:0,kn:0,ko:0,ksb:3,ksh:21,ku:3,kw:7,lag:18,lb:3,lg:3,ln:4,lo:0,lt:10,lv:6,mas:3,mg:4,mk:16,ml:3,mn:3,mo:9,mr:3,ms:0,mt:15,my:0,nah:3,naq:7,nb:3,nd:3,ne:3,nl:3,nn:3,no:3,nr:3,nso:4,ny:3,nyn:3,om:3,or:3,pa:3,pap:3,pl:13,ps:3,pt:3,rm:3,ro:9,rof:3,ru:11,rwk:3,sah:0,saq:3,se:7,seh:3,ses:0,sg:0,sh:11,shi:19,sk:12,sl:14,sma:7,smi:7,smj:7,smn:7,sms:7,sn:3,so:3,sq:3,sr:11,ss:3,ssy:3,st:3,sv:3,sw:3,syr:3,ta:3,te:3,teo:3,th:0,ti:4,tig:3,tk:3,tl:4,tn:3,to:0,tr:0,ts:3,tzm:22,uk:11,ur:3,ve:3,vi:0,vun:3,wa:4,wae:3,wo:0,xh:3,xog:3,yo:0,zh:0,zu:3};function isIn(n,list){return list.indexOf(n)!==-1}function isBetween(n,start,end){return typeof n===typeof start&&start<=n&&n<=end}var pluralRules={0:function(){return"other"},1:function(n){if(isBetween(n%100,3,10)){return"few"}if(n===0){return"zero"}if(isBetween(n%100,11,99)){return"many"}if(n===2){return"two"}if(n===1){return"one"}return"other"},2:function(n){if(n!==0&&n%10===0){return"many"}if(n===2){return"two"}if(n===1){return"one"}return"other"},3:function(n){if(n===1){return"one"}return"other"},4:function(n){if(isBetween(n,0,1)){return"one"}return"other"},5:function(n){if(isBetween(n,0,2)&&n!==2){return"one"}return"other"},6:function(n){if(n===0){return"zero"}if(n%10===1&&n%100!==11){return"one"}return"other"},7:function(n){if(n===2){return"two"}if(n===1){return"one"}return"other"},8:function(n){if(isBetween(n,3,6)){return"few"}if(isBetween(n,7,10)){return"many"}if(n===2){return"two"}if(n===1){return"one"}return"other"},9:function(n){if(n===0||n!==1&&isBetween(n%100,1,19)){return"few"}if(n===1){return"one"}return"other"},10:function(n){if(isBetween(n%10,2,9)&&!isBetween(n%100,11,19)){return"few"}if(n%10===1&&!isBetween(n%100,11,19)){return"one"}return"other"},11:function(n){if(isBetween(n%10,2,4)&&!isBetween(n%100,12,14)){return"few"}if(n%10===0||isBetween(n%10,5,9)||isBetween(n%100,11,14)){return"many"}if(n%10===1&&n%100!==11){return"one"}return"other"},12:function(n){if(isBetween(n,2,4)){return"few"}if(n===1){return"one"}return"other"},13:function(n){if(isBetween(n%10,2,4)&&!isBetween(n%100,12,14)){return"few"}if(n!==1&&isBetween(n%10,0,1)||isBetween(n%10,5,9)||isBetween(n%100,12,14)){return"many"}if(n===1){return"one"}return"other"},14:function(n){if(isBetween(n%100,3,4)){return"few"}if(n%100===2){return"two"}if(n%100===1){return"one"}return"other"},15:function(n){if(n===0||isBetween(n%100,2,10)){return"few"}if(isBetween(n%100,11,19)){return"many"}if(n===1){return"one"}return"other"},16:function(n){if(n%10===1&&n!==11){return"one"}return"other"},17:function(n){if(n===3){return"few"}if(n===0){return"zero"}if(n===6){return"many"}if(n===2){return"two"}if(n===1){return"one"}return"other"},18:function(n){if(n===0){return"zero"}if(isBetween(n,0,2)&&n!==0&&n!==2){return"one"}return"other"},19:function(n){if(isBetween(n,2,10)){return"few"}if(isBetween(n,0,1)){return"one"}return"other"},20:function(n){if((isBetween(n%10,3,4)||n%10===9)&&!(isBetween(n%100,10,19)||isBetween(n%100,70,79)||isBetween(n%100,90,99))){return"few"}if(n%1e6===0&&n!==0){return"many"}if(n%10===2&&!isIn(n%100,[12,72,92])){return"two"}if(n%10===1&&!isIn(n%100,[11,71,91])){return"one"}return"other"},21:function(n){if(n===0){return"zero"}if(n===1){return"one"}return"other"},22:function(n){if(isBetween(n,0,1)||isBetween(n,11,99)){return"one"}return"other"},23:function(n){if(isBetween(n%10,1,2)||n%20===0){
return"one"}return"other"},24:function(n){if(isBetween(n,3,10)||isBetween(n,13,19)){return"few"}if(isIn(n,[2,12])){return"two"}if(isIn(n,[1,11])){return"one"}return"other"}};var index=locales2rules[lang.replace(/-.*$/,"")];if(!(index in pluralRules)){return function(){return"other"}}return pluralRules[index]}var MAX_PLACEABLES=100;var PropertiesParser={patterns:null,entryIds:null,init:function(){this.patterns={comment:/^\s*#|^\s*$/,entity:/^([^=\s]+)\s*=\s*(.*)$/,multiline:/[^\\]\\$/,index:/\{\[\s*(\w+)(?:\(([^\)]*)\))?\s*\]\}/i,unicode:/\\u([0-9a-fA-F]{1,4})/g,entries:/[^\r\n]+/g,controlChars:/\\([\\\n\r\t\b\f\{\}\"\'])/g,placeables:/\{\{\s*([^\s]*?)\s*\}\}/}},parse:function(ctx,source){if(!this.patterns){this.init()}var ast=[];this.entryIds=Object.create(null);var entries=source.match(this.patterns.entries);if(!entries){return ast}for(var i=0;i<entries.length;i++){var line=entries[i];if(this.patterns.comment.test(line)){continue}while(this.patterns.multiline.test(line)&&i<entries.length){line=line.slice(0,-1)+entries[++i].trim()}var entityMatch=line.match(this.patterns.entity);if(entityMatch){try{this.parseEntity(entityMatch[1],entityMatch[2],ast)}catch(e){if(ctx){ctx._emitter.emit("parseerror",e)}else{throw e}}}}return ast},parseEntity:function(id,value,ast){var name,key;var pos=id.indexOf("[");if(pos!==-1){name=id.substr(0,pos);key=id.substring(pos+1,id.length-1)}else{name=id;key=null}var nameElements=name.split(".");if(nameElements.length>2){throw new L10nError('Error in ID: "'+name+'".'+" Nested attributes are not supported.")}var attr;if(nameElements.length>1){name=nameElements[0];attr=nameElements[1];if(attr[0]==="$"){throw new L10nError('Attribute can\'t start with "$"',id)}}else{attr=null}this.setEntityValue(name,attr,key,this.unescapeString(value),ast)},setEntityValue:function(id,attr,key,rawValue,ast){var pos,v;var value=rawValue.indexOf("{{")>-1?this.parseString(rawValue):rawValue;if(rawValue.indexOf("<")>-1||rawValue.indexOf("&")>-1){value={$o:value}}if(attr){pos=this.entryIds[id];if(pos===undefined){v={$i:id};if(key){v[attr]={};v[attr][key]=value}else{v[attr]=value}ast.push(v);this.entryIds[id]=ast.length-1;return}if(key){if(typeof ast[pos][attr]==="string"){ast[pos][attr]={$x:this.parseIndex(ast[pos][attr]),$v:{}}}ast[pos][attr].$v[key]=value;return}ast[pos][attr]=value;return}if(key){pos=this.entryIds[id];if(pos===undefined){v={};v[key]=value;ast.push({$i:id,$v:v});this.entryIds[id]=ast.length-1;return}if(typeof ast[pos].$v==="string"){ast[pos].$x=this.parseIndex(ast[pos].$v);ast[pos].$v={}}ast[pos].$v[key]=value;return}ast.push({$i:id,$v:value});this.entryIds[id]=ast.length-1},parseString:function(str){var chunks=str.split(this.patterns.placeables);var complexStr=[];var len=chunks.length;var placeablesCount=(len-1)/2;if(placeablesCount>=MAX_PLACEABLES){throw new L10nError("Too many placeables ("+placeablesCount+", max allowed is "+MAX_PLACEABLES+")")}for(var i=0;i<chunks.length;i++){if(chunks[i].length===0){continue}if(i%2===1){complexStr.push({t:"idOrVar",v:chunks[i]})}else{complexStr.push(chunks[i])}}return complexStr},unescapeString:function(str){if(str.lastIndexOf("\\")!==-1){str=str.replace(this.patterns.controlChars,"$1")}return str.replace(this.patterns.unicode,function(match,token){return unescape("%u"+"0000".slice(token.length)+token)})},parseIndex:function(str){var match=str.match(this.patterns.index);if(!match){throw new L10nError("Malformed index")}if(match[2]){return[{t:"idOrVar",v:match[1]},match[2]]}else{return[{t:"idOrVar",v:match[1]}]}}};var MAX_PLACEABLES_L20N=100;var L20nParser={_patterns:{identifier:/[A-Za-z_]\w*/g,unicode:/\\u([0-9a-fA-F]{1,4})/g,index:/@cldr\.plural\(\$?(\w+)\)/g,placeables:/\{\{\s*\$?([^\s]*?)\s*\}\}/,unesc:/\\({{|u[0-9a-fA-F]{4}|.)/g},parse:function(ctx,string,simple){this._source=string;this._index=0;this._length=this._source.length;this.simpleMode=simple;this.ctx=ctx;return this.getL20n()},getAttributes:function(){var attrs=Object.create(null);var attr,ws1,ch;while(true){attr=this.getKVPWithIndex();attrs[attr[0]]=attr[1];ws1=this.getRequiredWS();ch=this._source.charAt(this._index);if(ch===">"){break}else if(!ws1){throw this.error('Expected ">"')}}return attrs},getKVP:function(){var key=this.getIdentifier();this.getWS();if(this._source.charAt(this._index)!==":"){throw this.error('Expected ":"')}++this._index;this.getWS();return[key,this.getValue()]},getKVPWithIndex:function(){var key=this.getIdentifier();var index=null;if(this._source.charAt(this._index)==="["){++this._index;this.getWS();index=this.getIndex()}this.getWS();if(this._source.charAt(this._index)!==":"){throw this.error('Expected ":"')}++this._index;this.getWS();return[key,this.getValue(false,undefined,index)]},getHash:function(){++this._index;this.getWS();var hi,comma,hash={};while(true){hi=this.getKVP();hash[hi[0]]=hi[1];this.getWS();comma=this._source.charAt(this._index)===",";if(comma){++this._index;this.getWS()}if(this._source.charAt(this._index)==="}"){++this._index;break}if(!comma){throw this.error('Expected "}"')}}return hash},unescapeString:function(str,opchar){function replace(match,p1){switch(p1){case"\\":return"\\";case"{{":return"{{";case opchar:return opchar;default:if(p1.length===5&&p1.charAt(0)==="u"){return String.fromCharCode(parseInt(p1.substr(1),16))}throw this.error("Illegal unescape sequence")}}return str.replace(this._patterns.unesc,replace.bind(this))},getString:function(opchar){var overlay=false;var opcharPos=this._source.indexOf(opchar,this._index+1);outer:while(opcharPos!==-1){var backtrack=opcharPos-1;while(this._source.charCodeAt(backtrack)===92){if(this._source.charCodeAt(backtrack-1)===92){backtrack-=2}else{opcharPos=this._source.indexOf(opchar,opcharPos+1);continue outer}}break}if(opcharPos===-1){throw this.error("Unclosed string literal")}var buf=this._source.slice(this._index+1,opcharPos);this._index=opcharPos+1;if(!this.simpleMode&&buf.indexOf("\\")!==-1){buf=this.unescapeString(buf,opchar)}if(buf.indexOf("<")>-1||buf.indexOf("&")>-1){overlay=true}if(!this.simpleMode&&buf.indexOf("{{")!==-1){return[this.parseString(buf),overlay]}return[buf,overlay]},getValue:function(optional,ch,index){var val;if(ch===undefined){ch=this._source.charAt(this._index)}if(ch==="'"||ch==='"'){var valAndOverlay=this.getString(ch);if(valAndOverlay[1]){val={$o:valAndOverlay[0]}}else{val=valAndOverlay[0]}}else if(ch==="{"){val=this.getHash()}if(val===undefined){if(!optional){throw this.error("Unknown value type")}return null}if(index){return{$v:val,$x:index}}return val},getRequiredWS:function(){var pos=this._index;var cc=this._source.charCodeAt(pos);while(cc===32||cc===10||cc===9||cc===13){cc=this._source.charCodeAt(++this._index)}return this._index!==pos},getWS:function(){var cc=this._source.charCodeAt(this._index);while(cc===32||cc===10||cc===9||cc===13){cc=this._source.charCodeAt(++this._index)}},getIdentifier:function(){var reId=this._patterns.identifier;reId.lastIndex=this._index;var match=reId.exec(this._source);if(reId.lastIndex!==this._index+match[0].length){throw this.error("Identifier has to start with [a-zA-Z_]")}this._index=reId.lastIndex;return match[0]},getComment:function(){this._index+=2;var start=this._index;var end=this._source.indexOf("*/",start);if(end===-1){throw this.error("Comment without closing tag")}this._index=end+2;return},getEntity:function(id,index){var entity={$i:id};if(index){entity.$x=index}if(!this.getRequiredWS()){throw this.error("Expected white space")}var ch=this._source.charAt(this._index);var value=this.getValue(index===null,ch);var attrs=null;if(value===null){if(ch===">"){throw this.error('Expected ">"')}attrs=this.getAttributes()}else{entity.$v=value;var ws1=this.getRequiredWS();if(this._source.charAt(this._index)!==">"){if(!ws1){throw this.error('Expected ">"')}attrs=this.getAttributes()}}++this._index;if(attrs){for(var key in attrs){entity[key]=attrs[key]}}return entity},getEntry:function(){if(this._source.charCodeAt(this._index)===60){++this._index;var id=this.getIdentifier();if(this._source.charCodeAt(this._index)===91){++this._index;return this.getEntity(id,this.getIndex())}return this.getEntity(id,null)}if(this._source.charCodeAt(this._index)===47&&this._source.charCodeAt(this._index+1)===42){return this.getComment()}throw this.error("Invalid entry")},getL20n:function(){var ast=[];this.getWS();while(this._index<this._length){try{var entry=this.getEntry();if(entry){ast.push(entry)}}catch(e){if(this.ctx){this.ctx._emitter.emit("parsererror",e)}else{throw e}}if(this._index<this._length){this.getWS()}}return ast},getIndex:function(){this.getWS();this._patterns.index.lastIndex=this._index;var match=this._patterns.index.exec(this._source);this._index=this._patterns.index.lastIndex;this.getWS();this._index++;return[{t:"idOrVar",v:"plural"},match[1]]},parseString:function(str){var chunks=str.split(this._patterns.placeables);var complexStr=[];var len=chunks.length;var placeablesCount=(len-1)/2;if(placeablesCount>=MAX_PLACEABLES_L20N){throw new L10nError("Too many placeables ("+placeablesCount+", max allowed is "+MAX_PLACEABLES_L20N+")")}for(var i=0;i<chunks.length;i++){if(chunks[i].length===0){continue}if(i%2===1){complexStr.push({t:"idOrVar",v:chunks[i]})}else{complexStr.push(chunks[i])}}return complexStr},error:function(message,pos){if(pos===undefined){pos=this._index}var start=this._source.lastIndexOf("<",pos-1);var lastClose=this._source.lastIndexOf(">",pos-1);start=lastClose>start?lastClose+1:start;var context=this._source.slice(start,pos+10);var msg=message+" at pos "+pos+': "'+context+'"';return new L10nError(msg,pos,context)}};var KNOWN_MACROS=["plural"];var MAX_PLACEABLE_LENGTH=2500;var rePlaceables=/\{\{\s*(.+?)\s*\}\}/g;var nonLatin1=/[^\x01-\xFF]/;var FSI="⁨";var PDI="⁩";function createEntry(node,env){var keys=Object.keys(node);if(typeof node.$v==="string"&&keys.length===2){return node.$v}var attrs;for(var i=0,key;key=keys[i];i++){if(key[0]==="$"){continue}if(!attrs){attrs=Object.create(null)}attrs[key]=createAttribute(node[key],env,node.$i+"."+key)}return{id:node.$i,value:node.$v!==undefined?node.$v:null,index:node.$x||null,attrs:attrs||null,env:env,dirty:false}}function createAttribute(node,env,id){if(typeof node==="string"){return node}return{id:id,value:node.$v||(node!==undefined?node:null),index:node.$x||null,env:env,dirty:false}}function format(args,entity){var locals={overlay:false};if(typeof entity==="string"){return[locals,entity]}if(entity.dirty){throw new L10nError("Cyclic reference detected: "+entity.id)}entity.dirty=true;var rv;try{rv=resolveValue(locals,args,entity.env,entity.value,entity.index)}finally{entity.dirty=false}return rv}function resolveIdentifier(args,env,id){if(KNOWN_MACROS.indexOf(id)>-1){return[{},env["__"+id]]}if(args&&args.hasOwnProperty(id)){if(typeof args[id]==="string"||typeof args[id]==="number"&&!isNaN(args[id])){return[{},args[id]]}else{throw new L10nError("Arg must be a string or a number: "+id)}}if(id in env&&id!=="__proto__"){return format(args,env[id])}throw new L10nError("Unknown reference: "+id)}function subPlaceable(locals,args,env,id){var res;try{res=resolveIdentifier(args,env,id)}catch(err){return[{error:err},"{{ "+id+" }}"]}var value=res[1];if(typeof value==="number"){return res}if(typeof value==="string"){if(value.length>=MAX_PLACEABLE_LENGTH){throw new L10nError("Too many characters in placeable ("+value.length+", max allowed is "+MAX_PLACEABLE_LENGTH+")")}if(locals.contextIsNonLatin1||value.match(nonLatin1)){res[1]=FSI+value+PDI}return res}return[{},"{{ "+id+" }}"]}function interpolate(locals,args,env,arr){return arr.reduce(function(prev,cur){if(typeof cur==="string"){return[prev[0],prev[1]+cur]}else if(cur.t==="idOrVar"){var placeable=subPlaceable(locals,args,env,cur.v);if(placeable[0].overlay){prev[0].overlay=true}return[prev[0],prev[1]+placeable[1]]}},[locals,""])}function resolveSelector(args,env,expr,index){var selectorName=index[0].v;var selector=resolveIdentifier(args,env,selectorName)[1];if(typeof selector!=="function"){return selector}var argValue=index[1]?resolveIdentifier(args,env,index[1])[1]:undefined;if(selector===env.__plural){if(argValue===0&&"zero"in expr){return"zero"}if(argValue===1&&"one"in expr){return"one"}if(argValue===2&&"two"in expr){return"two"}}return selector(argValue)}function resolveValue(locals,args,env,expr,index){if(!expr){return[locals,expr]}if(expr.$o){expr=expr.$o;locals.overlay=true}if(typeof expr==="string"||typeof expr==="boolean"||typeof expr==="number"){return[locals,expr]}if(Array.isArray(expr)){locals.contextIsNonLatin1=expr.some(function($_){return typeof $_==="string"&&$_.match(nonLatin1)});return interpolate(locals,args,env,expr)}if(index){var selector=resolveSelector(args,env,expr,index);if(expr.hasOwnProperty(selector)){return resolveValue(locals,args,env,expr[selector])}}if("other"in expr){return resolveValue(locals,args,env,expr.other)}throw new L10nError("Unresolvable value")}var Resolver={createEntry:createEntry,format:format,rePlaceables:rePlaceables};function walkContent(node,fn){if(typeof node==="string"){return fn(node)}if(node.t==="idOrVar"){return node}var rv=Array.isArray(node)?[]:{};var keys=Object.keys(node);for(var i=0,key;key=keys[i];i++){if(key==="$i"||key==="$x"){rv[key]=node[key]}else{rv[key]=walkContent(node[key],fn)}}return rv}var reAlphas=/[a-zA-Z]/g;var reVowels=/[aeiouAEIOU]/g;var ACCENTED_MAP="ȦƁƇḒḖƑƓĦĪ"+"ĴĶĿḾȠǾƤɊŘ"+"ŞŦŬṼẆẊẎẐ"+"[\\]^_`"+"ȧƀƈḓḗƒɠħī"+"ĵķŀḿƞǿƥɋř"+"şŧŭṽẇẋẏẑ";var FLIPPED_MAP="∀ԐↃpƎɟפHIſ"+"Ӽ˥WNOԀÒᴚS⊥∩Ʌ"+"ＭXʎZ"+"[\\]ᵥ_,"+"ɐqɔpǝɟƃɥıɾ"+"ʞʅɯuodbɹsʇnʌʍxʎz";function makeLonger(val){return val.replace(reVowels,function(match){return match+match.toLowerCase()})}function replaceChars(map,val){return val.replace(reAlphas,function(match){return map.charAt(match.charCodeAt(0)-65)})}var reWords=/[^\W0-9_]+/g;function makeRTL(val){return val.replace(reWords,function(match){return"‮"+match+"‬"})}var reExcluded=/(%[EO]?\w|\{\s*.+?\s*\}|&[#\w]+;|<\s*.+?\s*>)/;function mapContent(fn,val){if(!val){return val}var parts=val.split(reExcluded);var modified=parts.map(function(part){if(reExcluded.test(part)){return part}return fn(part)});return modified.join("")}function Pseudo(id,name,charMap,modFn){this.id=id;this.translate=mapContent.bind(null,function(val){return replaceChars(charMap,modFn(val))});this.name=this.translate(name)}var PSEUDO={"qps-ploc":new Pseudo("qps-ploc","Runtime Accented",ACCENTED_MAP,makeLonger),"qps-plocm":new Pseudo("qps-plocm","Runtime Mirrored",FLIPPED_MAP,makeRTL)};function Locale(id,ctx){this.id=id;this.ctx=ctx;this.isReady=false;this.entries=Object.create(null);this.entries.__plural=getPluralRule(this.isPseudo()?this.ctx.defaultLocale:id)}Locale.prototype.isPseudo=function(){return this.ctx.qps.indexOf(this.id)!==-1};var bindingsIO={extra:function(id,ver,path,type,callback,errback){if(type==="properties"){type="text"}navigator.mozApps.getLocalizationResource(id,ver,path,type).then(callback.bind(null,null),errback)},app:function(id,ver,path,type,callback,errback,sync){switch(type){case"properties":io.load(path,callback,sync);break;case"json":io.loadJSON(path,callback,sync);break}}};Locale.prototype.build=function L_build(callback){var sync=!callback;var ctx=this.ctx;var self=this;var l10nLoads=ctx.resLinks.length;function onL10nLoaded(err){if(err){ctx._emitter.emit("fetcherror",err)}if(--l10nLoads<=0){self.isReady=true;if(callback){callback()}}}if(l10nLoads===0){onL10nLoaded();return}function onJSONLoaded(err,json){if(!err&&json){self.addAST(json)}onL10nLoaded(err)}function onPropLoaded(err,source){if(!err&&source){var ast=PropertiesParser.parse(ctx,source);self.addAST(ast)}onL10nLoaded(err)}function onL20nLoaded(err,source){if(!err&&source){var ast=L20nParser.parse(ctx,source);self.addAST(ast)}onL10nLoaded(err)}var idToFetch=this.isPseudo()?ctx.defaultLocale:this.id;var appVersion=null;var source="app";if(typeof navigator!=="undefined"){source=navigator.mozL10n._config.localeSources[this.id]||"app";appVersion=navigator.mozL10n._config.appVersion}for(var i=0;i<ctx.resLinks.length;i++){var resLink=decodeURI(ctx.resLinks[i]);var path=resLink.replace("{locale}",idToFetch);var type=path.substr(path.lastIndexOf(".")+1);var cb;switch(type){case"json":cb=onJSONLoaded;break;case"properties":cb=onPropLoaded;break;case"l20n":io.load(path,onL20nLoaded,sync);break}bindingsIO[source](this.id,appVersion,path,type,cb,onL10nLoaded,sync)}};function createPseudoEntry(node,entries){return Resolver.createEntry(walkContent(node,PSEUDO[this.id].translate),entries)}Locale.prototype.addAST=function(ast){var createEntry=this.isPseudo()?createPseudoEntry.bind(this):Resolver.createEntry;for(var i=0;i<ast.length;i++){this.entries[ast[i].$i]=createEntry(ast[i],this.entries)}};function Context(id){this.id=id;this.isReady=false;this.isLoading=false;this.defaultLocale="en-US";this.availableLocales=[];this.supportedLocales=[];this.qps=[];this.resLinks=[];this.locales={};this._emitter=new EventEmitter;this._ready=new Promise(this.once.bind(this))}function reportMissing(id,err){this._emitter.emit("notfounderror",err);return id}function getWithFallback(id){var cur=0;var loc;var locale;while(loc=this.supportedLocales[cur]){locale=this.getLocale(loc);if(!locale.isReady){locale.build(null)}var entry=locale.entries[id];if(entry===undefined){cur++;reportMissing.call(this,id,new L10nError('"'+id+'"'+" not found in "+loc+" in "+this.id,id,loc));continue}return entry}throw new L10nError('"'+id+'"'+" missing from all supported locales in "+this.id,id)}function formatTuple(args,entity){try{return Resolver.format(args,entity)}catch(err){this._emitter.emit("resolveerror",err);var locals={error:err};return[locals,entity.id]}}function formatValue(args,entity){if(typeof entity==="string"){return entity}return formatTuple.call(this,args,entity)[1]}function formatEntity(args,entity){var entityTuple=formatTuple.call(this,args,entity);var locals=entityTuple[0];var value=entityTuple[1];var formatted={value:value,attrs:null,overlay:locals.overlay};if(entity.attrs){formatted.attrs=Object.create(null)}for(var key in entity.attrs){var attrTuple=formatTuple.call(this,args,entity.attrs[key]);formatted.attrs[key]=attrTuple[1];if(attrTuple[0].overlay){formatted.overlay=true}}return formatted}function formatAsync(fn,id,args){return this._ready.then(getWithFallback.bind(this,id)).then(fn.bind(this,args),reportMissing.bind(this,id))}Context.prototype.formatValue=function(id,args){return formatAsync.call(this,formatValue,id,args)};Context.prototype.formatEntity=function(id,args){return formatAsync.call(this,formatEntity,id,args)};function legacyGet(fn,id,args){if(!this.isReady){throw new L10nError("Context not ready")}var entry;try{entry=getWithFallback.call(this,id)}catch(err){if(err.loc){throw err}reportMissing.call(this,id,err);return""}return fn.call(this,args,entry)}Context.prototype.get=function(id,args){return legacyGet.call(this,formatValue,id,args)};Context.prototype.getEntity=function(id,args){return legacyGet.call(this,formatEntity,id,args)};Context.prototype.getLocale=function getLocale(code){var locales=this.locales;if(locales[code]){return locales[code]}return locales[code]=new Locale(code,this)};function negotiate(available,requested,defaultLocale){var supportedLocale;for(var i=0;i<requested.length;i++){var locale=requested[i];if(available.indexOf(locale)!==-1){supportedLocale=locale;break}}if(!supportedLocale||supportedLocale===defaultLocale){return[defaultLocale]}return[supportedLocale,defaultLocale]}function freeze(supported){var locale=this.getLocale(supported[0]);if(locale.isReady){setReady.call(this,supported)}else{locale.build(setReady.bind(this,supported))}}function setReady(supported){this.supportedLocales=supported;this.isReady=true;this._emitter.emit("ready")}Context.prototype.registerLocales=function(defLocale,available){if(defLocale){this.defaultLocale=defLocale}this.availableLocales=[this.defaultLocale];this.qps=Object.keys(PSEUDO);if(available){for(var i=0,loc;loc=available[i];i++){if(this.availableLocales.indexOf(loc)===-1){this.availableLocales.push(loc);var pos=this.qps.indexOf(loc);if(pos!==-1){this.qps.splice(pos,1)}}}}};Context.prototype.requestLocales=function requestLocales(){if(this.isLoading&&!this.isReady){throw new L10nError("Context not ready")}this.isLoading=true;var requested=Array.prototype.slice.call(arguments);if(requested.length===0){throw new L10nError("No locales requested")}var supported=negotiate(this.availableLocales.concat(this.qps),requested,this.defaultLocale);if(this.supportedLocales[0]!==supported[0]){freeze.call(this,supported)}};Context.prototype.addEventListener=function(type,listener){this._emitter.addEventListener(type,listener)};Context.prototype.removeEventListener=function(type,listener){this._emitter.removeEventListener(type,listener)};Context.prototype.ready=function(callback){if(this.isReady){setTimeout(callback)}this.addEventListener("ready",callback)};Context.prototype.once=function(callback){if(this.isReady){setTimeout(callback);return}var callAndRemove=function(){this.removeEventListener("ready",callAndRemove);callback()}.bind(this);this.addEventListener("ready",callAndRemove)};var allowed={elements:["a","em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","br","wbr"],attributes:{global:["title","aria-label","aria-valuetext","aria-moz-hint"],a:["download"],area:["download","alt"],input:["alt","placeholder"],menuitem:["label"],menu:["label"],optgroup:["label"],option:["label"],track:["label"],img:["alt"],textarea:["placeholder"],th:["abbr"]}};var rtlList=["ar","he","fa","ps","qps-plocm","ur"];var nodeObserver=null;var pendingElements=null;var moConfig={attributes:true,characterData:false,childList:true,subtree:true,attributeFilter:["data-l10n-id","data-l10n-args"]};navigator.mozL10n={ctx:null,get:function get(id,ctxdata){return navigator.mozL10n.ctx.get(id,ctxdata)},formatValue:function(id,ctxdata){return navigator.mozL10n.ctx.formatValue(id,ctxdata)},formatEntity:function(id,ctxdata){return navigator.mozL10n.ctx.formatEntity(id,ctxdata)},translateFragment:function(fragment){return translateFragment.call(navigator.mozL10n,fragment)},setAttributes:setL10nAttributes,getAttributes:getL10nAttributes,ready:function ready(callback){return navigator.mozL10n.ctx.ready(callback)},once:function once(callback){return navigator.mozL10n.ctx.once(callback)},get readyState(){return navigator.mozL10n.ctx.isReady?"complete":"loading"},language:{set code(lang){navigator.mozL10n.ctx.requestLocales(lang)},get code(){return navigator.mozL10n.ctx.supportedLocales[0]},get direction(){return getDirection(navigator.mozL10n.ctx.supportedLocales[0])}},qps:PSEUDO,_config:{appVersion:null,localeSources:Object.create(null),isPretranslated:false},_getInternalAPI:function(){return{Error:L10nError,Context:Context,Locale:Locale,Resolver:Resolver,getPluralRule:getPluralRule,rePlaceables:rePlaceables,translateDocument:translateDocument,onMetaInjected:onMetaInjected,PropertiesParser:PropertiesParser,L20nParser:L20nParser,walkContent:walkContent,buildLocaleList:buildLocaleList}}};function getDirection(lang){return rtlList.indexOf(lang)>=0?"rtl":"ltr"}var readyStates={loading:0,interactive:1,complete:2};function waitFor(state,callback){state=readyStates[state];if(readyStates[document.readyState]>=state){callback();return}document.addEventListener("readystatechange",function l10n_onrsc(){if(readyStates[document.readyState]>=state){document.removeEventListener("readystatechange",l10n_onrsc);callback()}})}function initObserver(){nodeObserver=new MutationObserver(onMutations.bind(navigator.mozL10n));nodeObserver.observe(document,moConfig)}function init(pretranslate){if(!pretranslate){initObserver()}initResources.call(navigator.mozL10n)}function initResources(){var meta={};var nodes=document.head.querySelectorAll('link[rel="localization"],'+'meta[name="availableLanguages"],'+'meta[name="defaultLanguage"],'+'meta[name="appVersion"],'+'script[type="application/l10n"]');for(var i=0,node;node=nodes[i];i++){var type=node.getAttribute("rel")||node.nodeName.toLowerCase();switch(type){case"localization":this.ctx.resLinks.push(node.getAttribute("href"));break;case"meta":onMetaInjected.call(this,node,meta);break;case"script":onScriptInjected.call(this,node);break}}var additionalLanguagesPromise;if(navigator.mozApps&&navigator.mozApps.getAdditionalLanguages){additionalLanguagesPromise=navigator.mozApps.getAdditionalLanguages().catch(function(e){console.error("Error while loading getAdditionalLanguages",e)});document.addEventListener("additionallanguageschange",function(evt){registerLocales.call(this,meta,evt.detail);this.ctx.requestLocales.apply(this.ctx,navigator.languages||[navigator.language])}.bind(this))}else{additionalLanguagesPromise=Promise.resolve()}additionalLanguagesPromise.then(function(extraLangs){registerLocales.call(this,meta,extraLangs);initLocale.call(this)}.bind(this))}function registerLocales(meta,extraLangs){var locales=buildLocaleList.call(this,meta,extraLangs);navigator.mozL10n._config.localeSources=locales[1];this.ctx.registerLocales(locales[0],Object.keys(locales[1]))}function getMatchingLangpack(appVersion,langpacks){for(var i=0,langpack;langpack=langpacks[i];i++){if(langpack.target===appVersion){return langpack}}return null}function buildLocaleList(meta,extraLangs){var loc,lp;var localeSources=Object.create(null);var defaultLocale=meta.defaultLanguage||this.ctx.defaultLocale;if(meta.availableLanguages){for(loc in meta.availableLanguages){localeSources[loc]="app"}}if(extraLangs){for(loc in extraLangs){lp=getMatchingLangpack(this._config.appVersion,extraLangs[loc]);if(!lp){continue}if(!(loc in localeSources)||!meta.availableLanguages[loc]||parseInt(lp.revision)>meta.availableLanguages[loc]){localeSources[loc]="extra"}}}if(!(defaultLocale in localeSources)){localeSources[defaultLocale]="app"}return[defaultLocale,localeSources]}function splitAvailableLanguagesString(str){var langs={};str.split(",").forEach(function(lang){lang=lang.trim().split(":");langs[lang[0]]=parseInt(lang[1])});return langs}function onMetaInjected(node,meta){switch(node.getAttribute("name")){case"availableLanguages":meta.availableLanguages=splitAvailableLanguagesString(node.getAttribute("content"));break;case"defaultLanguage":meta.defaultLanguage=node.getAttribute("content");break;case"appVersion":navigator.mozL10n._config.appVersion=node.getAttribute("content");break}}function onScriptInjected(node){var lang=node.getAttribute("lang");var locale=this.ctx.getLocale(lang);locale.addAST(JSON.parse(node.textContent))}function initLocale(){this.ctx.requestLocales.apply(this.ctx,navigator.languages||[navigator.language]);window.addEventListener("languagechange",function l10n_langchange(){this.ctx.requestLocales.apply(this.ctx,navigator.languages||[navigator.language])}.bind(this))}function localizeMutations(mutations){var mutation;var targets=new Set;for(var i=0;i<mutations.length;i++){mutation=mutations[i];if(mutation.type==="childList"){var addedNode;for(var j=0;j<mutation.addedNodes.length;j++){addedNode=mutation.addedNodes[j];if(addedNode.nodeType!==Node.ELEMENT_NODE){continue}targets.add(addedNode)}}if(mutation.type==="attributes"){targets.add(mutation.target)}}targets.forEach(function(target){if(target.childElementCount){translateFragment.call(this,target)}else if(target.hasAttribute("data-l10n-id")){translateElement.call(this,target)}},this)}function onMutations(mutations,self){self.disconnect();localizeMutations.call(this,mutations);self.observe(document,moConfig)}function onReady(){if(!navigator.mozL10n._config.isPretranslated){translateDocument.call(this)}navigator.mozL10n._config.isPretranslated=false;if(pendingElements){for(var i=0,element;element=pendingElements[i];i++){translateElement.call(this,element)}pendingElements=null}if(!nodeObserver){initObserver()}fireLocalizedEvent.call(this)}function fireLocalizedEvent(){var event=new CustomEvent("localized",{bubbles:false,cancelable:false,detail:{language:this.ctx.supportedLocales[0]}});window.dispatchEvent(event)}function translateDocument(){document.documentElement.lang=this.language.code;document.documentElement.dir=this.language.direction;translateFragment.call(this,document.documentElement)}function translateFragment(element){if(typeof element.hasAttribute==="function"&&element.hasAttribute("data-l10n-id")){translateElement.call(this,element)}var nodes=getTranslatableChildren(element);for(var i=0;i<nodes.length;i++){translateElement.call(this,nodes[i])}}function setL10nAttributes(element,id,args){element.setAttribute("data-l10n-id",id);if(args){element.setAttribute("data-l10n-args",JSON.stringify(args))}}function getL10nAttributes(element){return{id:element.getAttribute("data-l10n-id"),args:JSON.parse(element.getAttribute("data-l10n-args"))}}function getTranslatableChildren(element){return element?element.querySelectorAll("*[data-l10n-id]"):[]}function camelCaseToDashed(string){if(string==="ariaValueText"){return"aria-valuetext"}return string.replace(/[A-Z]/g,function(match){return"-"+match.toLowerCase()}).replace(/^-/,"")}function translateElement(element){if(!this.ctx.isReady){if(!pendingElements){pendingElements=[]}pendingElements.push(element);return}var l10n=getL10nAttributes(element);if(!l10n.id){return false}var entity=this.ctx.getEntity(l10n.id,l10n.args);var value;if(entity.attrs&&entity.attrs.innerHTML){value=entity.attrs.innerHTML;console.warn("L10n Deprecation Warning: using innerHTML in translations is unsafe "+"and will not be supported in future versions of l10n.js. "+"See https://bugzil.la/1027117")}else{value=entity.value}if(typeof value==="string"){if(!entity.overlay){element.textContent=value}else{var translation=element.ownerDocument.createElement("template");translation.innerHTML=value;overlayElement(element,translation.content)}}for(var key in entity.attrs){var attrName=camelCaseToDashed(key);if(isAttrAllowed({name:attrName},element)){element.setAttribute(attrName,entity.attrs[key])}}}function overlayElement(sourceElement,translationElement){var result=translationElement.ownerDocument.createDocumentFragment();var k,attr;var childElement;while(childElement=translationElement.childNodes[0]){translationElement.removeChild(childElement);if(childElement.nodeType===Node.TEXT_NODE){result.appendChild(childElement);continue}var index=getIndexOfType(childElement);var sourceChild=getNthElementOfType(sourceElement,childElement,index);if(sourceChild){overlayElement(sourceChild,childElement);result.appendChild(sourceChild);continue}if(isElementAllowed(childElement)){for(k=0,attr;attr=childElement.attributes[k];k++){if(!isAttrAllowed(attr,childElement)){childElement.removeAttribute(attr.name)}}result.appendChild(childElement);continue}result.appendChild(document.createTextNode(childElement.textContent))}sourceElement.textContent="";sourceElement.appendChild(result);if(translationElement.attributes){for(k=0,attr;attr=translationElement.attributes[k];k++){if(isAttrAllowed(attr,sourceElement)){sourceElement.setAttribute(attr.name,attr.value)}}}}function isElementAllowed(element){return allowed.elements.indexOf(element.tagName.toLowerCase())!==-1}function isAttrAllowed(attr,element){var attrName=attr.name.toLowerCase();var tagName=element.tagName.toLowerCase();if(allowed.attributes.global.indexOf(attrName)!==-1){return true}if(!allowed.attributes[tagName]){return false}if(allowed.attributes[tagName].indexOf(attrName)!==-1){return true}if(tagName==="input"&&attrName==="value"){var type=element.type.toLowerCase();if(type==="submit"||type==="button"||type==="reset"){return true}}return false}function getNthElementOfType(context,element,index){var nthOfType=0;for(var i=0,child;child=context.children[i];i++){if(child.nodeType===Node.ELEMENT_NODE&&child.tagName===element.tagName){if(nthOfType===index){return child}nthOfType++}}return null}function getIndexOfType(element){var index=0;var child;while(child=element.previousElementSibling){if(child.tagName===element.tagName){
index++}}return index}var DEBUG=false;navigator.mozL10n.ctx=new Context(window.document?document.URL:null);navigator.mozL10n.ctx.ready(onReady.bind(navigator.mozL10n));navigator.mozL10n.ctx.addEventListener("notfounderror",function reportMissingEntity(e){if(DEBUG||e.loc==="en-US"){console.warn(e.toString())}});if(DEBUG){navigator.mozL10n.ctx.addEventListener("fetcherror",console.error.bind(console));navigator.mozL10n.ctx.addEventListener("parseerror",console.error.bind(console));navigator.mozL10n.ctx.addEventListener("resolveerror",console.error.bind(console))}if(window.document){navigator.mozL10n._config.isPretranslated=document.documentElement.lang===navigator.language;var pretranslate=document.documentElement.dataset.noCompleteBug?true:!navigator.mozL10n._config.isPretranslated;waitFor("interactive",init.bind(navigator.mozL10n,pretranslate))}})(this);